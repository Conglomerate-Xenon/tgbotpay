import sqlite3
import random

DB_NAME = "quiz.db"

def init_db():
    conn = sqlite3.connect(DB_NAME)
    cursor = conn.cursor()
    
    cursor.execute("""
    CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY,
        username TEXT,
        score INTEGER DEFAULT 0
    );
    """)
    
    cursor.execute("""
    CREATE TABLE IF NOT EXISTS questions (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        text TEXT NOT NULL,
        option1 TEXT,
        option2 TEXT,
        option3 TEXT,
        option4 TEXT,
        correct_option INTEGER
    );
    """)
    
    conn.commit()
    conn.close()


def add_user(user_id, username):
    conn = sqlite3.connect(DB_NAME)
    cursor = conn.cursor()
    cursor.execute("INSERT OR IGNORE INTO users (id, username) VALUES (?, ?)", (user_id, username))
    conn.commit()
    conn.close()


def update_score(user_id, delta):
    conn = sqlite3.connect(DB_NAME)
    cursor = conn.cursor()
    cursor.execute("UPDATE users SET score = score + ? WHERE id = ?", (delta, user_id))
    conn.commit()
    conn.close()


def get_random_question():
    conn = sqlite3.connect(DB_NAME)
    cursor = conn.cursor()
    cursor.execute("SELECT * FROM questions ORDER BY RANDOM() LIMIT 1")
    row = cursor.fetchone()
    conn.close()
    return row


def get_top_users(limit=10):
    conn = sqlite3.connect(DB_NAME)
    cursor = conn.cursor()
    cursor.execute("SELECT username, score FROM users ORDER BY score DESC LIMIT ?", (limit,))
    rows = cursor.fetchall()
    conn.close()
    return rows


def seed_questions():
    questions = [
        ("Какой элемент обозначается символом H?", "Кислород", "Водород", "Гелий", "Углерод", 2),
        ("Кто написал 'Войну и мир'?", "Фёдор Достоевский", "Антон Чехов", "Лев Толстой", "Александр Пушкин", 3),
        ("Сколько планет в Солнечной системе?", "8", "9", "7", "10", 1),
        ("Какое животное самое быстрое на суше?", "Лев", "Гепард", "Тигр", "Кенгуру", 2),
        ("Столица Австралии?", "Мельбурн", "Канберра", "Сидней", "Перт", 2),
        ("Кто основал Microsoft?", "Стив Джобс", "Билл Гейтс", "Илон Маск", "Марк Цукерберг", 2),
        ("Сколько цветов в радуге?", "5", "6", "7", "8", 3),
        ("Кто нарисовал Мону Лизу?", "Рафаэль", "Микеланджело", "Леонардо да Винчи", "Рембрандт", 3),
        ("Какой газ люди вдыхают?", "Кислород", "Углекислый газ", "Азот", "Водород", 1),
        ("Какой океан самый большой?", "Индийский", "Атлантический", "Тихий", "Северный Ледовитый", 3),
        ("Какой язык программирования разработал Гвидо ван Россум?", "C++", "Python", "Java", "PHP", 2),
        ("В каком году человек впервые высадился на Луну?", "1965", "1969", "1971", "1963", 2),
        ("Какой континент самый большой по площади?", "Африка", "Азия", "Северная Америка", "Антарктида", 2),
        ("Кто был первым президентом США?", "Авраам Линкольн", "Томас Джефферсон", "Джордж Вашингтон", "Бенджамин Франклин", 3),
        ("Какое из этих чисел является простым?", "9", "15", "11", "21", 3),
        ("Какая страна выиграла чемпионат мира по футболу в 2018 году?", "Бразилия", "Франция", "Германия", "Аргентина", 2),
        ("Что тяжелее: килограмм пуха или килограмм свинца?", "Пух", "Свинец", "Одинаково", "Зависит от плотности", 3),
        ("Какой химический элемент обозначается как 'Fe'?", "Фтор", "Фосфор", "Железо", "Цинк", 3),
        ("Какая планета ближе всего к Солнцу?", "Земля", "Меркурий", "Марс", "Венера", 2),
        ("Сколько часов в сутках?", "12", "24", "48", "36", 2),
        ("Какой город является столицей Канады?", "Торонто", "Монреаль", "Оттава", "Ванкувер", 3),
        ("Какой математический знак обозначает умножение?", "+", "-", "*", "/", 3),
        ("Кто написал 'Преступление и наказание'?", "Гоголь", "Толстой", "Достоевский", "Пушкин", 3),
        ("Какой цвет получается при смешивании синего и жёлтого?", "Зелёный", "Оранжевый", "Фиолетовый", "Коричневый", 1),
        ("Кто нарисовал флаг Франции?", "Пикассо", "Никто", "Художник Революции", "Неизвестен", 2),
        ("Какой инструмент использует скрипач?", "Гитара", "Скрипка", "Флейта", "Контрабас", 2),
        ("Какая страна находится на двух континентах?", "Испания", "Канада", "Россия", "Швейцария", 3),
        ("Какой орган отвечает за перекачивание крови?", "Печень", "Почки", "Сердце", "Лёгкие", 3),
        ("Как зовут главного героя в Гарри Поттере?", "Гермиона", "Гарри", "Рон", "Снейп", 2),
        ("Как называется столица Японии?", "Осака", "Киото", "Токио", "Хиросима", 3),
        ("Сколько сторон у треугольника?", "4", "3", "5", "6", 2),
        ("В каком месяце 28 дней?", "Только в феврале", "Все", "Апрель", "Июнь", 2),
        ("Какой язык используется в браузере для стилизации страниц?", "HTML", "Python", "CSS", "SQL", 3),
        ("Кто был первым космонавтом?", "Юрий Гагарин", "Нил Армстронг", "Алексей Леонов", "Джон Гленн", 1),
        ("Какое число идёт после 99?", "100", "101", "98", "99.1", 1),
        ("Где находится пирамида Хеопса?", "Мексика", "Китай", "Египет", "Греция", 3),
        ("Какая кровь считается универсальной?", "AB", "B", "A", "O", 4),
        ("Какой из этих фильмов снял Кристофер Нолан?", "Интерстеллар", "Аватар", "Титаник", "Мстители", 1),
        ("Сколько ног у паука?", "6", "8", "10", "12", 2),
        ("Какой металл самый лёгкий?", "Железо", "Алюминий", "Литий", "Медь", 3),
        ("Какой вид энергии используют солнечные панели?", "Тепловую", "Ядерную", "Солнечную", "Магнитную", 3),
        ("Сколько метров в километре?", "10", "100", "1000", "10000", 3),
        ("Кто написал «Гарри Поттера»?", "Толкин", "Роулинг", "Рик Риордан", "Льюис", 2),
        ("Сколько секунд в одной минуте?", "100", "60", "80", "30", 2),
        ("Что означает 'www'?", "World Web Window", "World Wide Web", "Web Wide World", "Web Work Window", 2),
        ("Какой фрукт внутри зелёный с чёрными семечками?", "Киви", "Арбуз", "Авокадо", "Груша", 1),
        ("Что из этого — программа?", "Microsoft Word", "Клавиатура", "Монитор", "Кулер", 1),
        ("Как называется столица Германии?", "Мюнхен", "Гамбург", "Берлин", "Бонн", 3),
        ("Сколько дней в високосном году?", "365", "366", "364", "360", 2),
        ("Какое животное символизирует Китай?", "Панда", "Тигр", "Дракон", "Слон", 1)
    ]

    conn = sqlite3.connect(DB_NAME)
    cursor = conn.cursor()
    cursor.executemany(
        "INSERT INTO questions (text, option1, option2, option3, option4, correct_option) VALUES (?, ?, ?, ?, ?, ?)",
        questions
    )
    conn.commit()
    conn.close()

